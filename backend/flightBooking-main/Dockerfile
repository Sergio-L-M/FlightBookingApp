# Etapa 1: Construcci贸n con Gradle
FROM gradle:8.5-jdk21 AS build

WORKDIR /app

# Copiar archivos de configuraci贸n
COPY build.gradle settings.gradle ./

# Copiar el c贸digo fuente completo, incluyendo los mocks en `src/test/resources/`
COPY src src

#  Asegurar que `test/resources/` est茅 disponible en `build/resources/test/`
RUN mkdir -p build/resources/test && cp -r src/test/resources/. build/resources/test/

# Ejecutar Gradle para construir el JAR
RUN gradle clean build -x test --no-daemon

#  Verificar si los archivos mock realmente est谩n en la etapa de compilaci贸n
RUN ls -l /app/src/test/resources/
RUN ls -l /app/src/test/resources/sortList/

# Etapa 2: Crear una imagen m谩s ligera con solo el JAR y los archivos mock
FROM eclipse-temurin:21-jdk
WORKDIR /app

# Copiar el JAR desde la etapa de compilaci贸n
COPY --from=build /app/build/libs/*.jar app.jar

#  Copiar toda la carpeta `src/` a la imagen final para asegurar que los mocks est谩n disponibles
COPY --from=build /app/src/ /app/src/

# Exponer el puerto 8080
EXPOSE 8080

# Ejecutar la aplicaci贸n
CMD ["java", "-jar", "app.jar"]
